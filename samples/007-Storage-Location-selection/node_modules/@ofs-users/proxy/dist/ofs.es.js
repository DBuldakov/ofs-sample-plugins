import{readFileSync as t}from"fs";function __awaiter(t,e,s,i){return new(s||(s=Promise))((function(n,r){function fulfilled(t){try{step(i.next(t))}catch(t){r(t)}}function rejected(t){try{step(i.throw(t))}catch(t){r(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((i=i.apply(t,e||[])).next())}))}class OFSResponse{constructor(t,e,s,i,n){this.status=-1,this.status=e,this.description=s,this.data=i,this.url=t,this.contentType=n}}class OFSPropertyList{constructor(){this.items=[],this.limit=0,this.offset=0,this.totalResults=0}}class OFSSubscriptionResponse extends OFSResponse{constructor(){super(...arguments),this.data={totalResults:0,items:[],links:void 0}}}class OFSActivityResponse extends OFSResponse{constructor(){super(...arguments),this.data={customerName:void 0,activityId:0}}}class OFSPropertyDetailsResponse extends OFSResponse{constructor(){super(...arguments),this.data={label:"",name:"",type:"string",entity:"activity",gui:"",translations:[],links:void 0}}}class OFSPropertyListResponse extends OFSResponse{constructor(){super(...arguments),this.data=new OFSPropertyList}}class OFS{get credentials(){return this._credentials}set credentials(t){this._credentials=t,this._hash=OFS.authenticateUser(t),this._baseURL=new URL(`https://${this.instance}.${OFS.DEFAULT_DOMAIN}`)}get authorization(){return this._hash}constructor(t){this.credentials=t}get instance(){return this.credentials.instance}static authenticateUser(t){var e=t.clientId+"@"+t.instance+":"+t.clientSecret;return"Basic "+Buffer.from(e).toString("base64")}_get(t,e=void 0,s=new Headers){var i=new URL(t,this._baseURL);if(null!=e){const t=new URLSearchParams(e);i.search=t.toString()}var n=new Headers;n.append("Authorization",this.authorization),s.forEach(((t,e)=>{console.log(e,t),n.append(e,t)}));return fetch(i,{method:"GET",headers:n}).then((function(t){var e,s;return __awaiter(this,void 0,void 0,(function*(){var n;return t.status<400?(n=(null===(e=t.headers.get("Content-Type"))||void 0===e?void 0:e.includes("json"))?yield t.json():(null===(s=t.headers.get("Content-Type"))||void 0===s?void 0:s.includes("text"))?yield t.text():yield t.blob(),new OFSResponse(i,t.status,void 0,n,t.headers.get("Content-Type")||void 0)):new OFSResponse(i,t.status,t.statusText,void 0)}))})).catch((t=>(console.log("error",t),new OFSResponse(i,-1))))}_patch(t,e){var s=new URL(t,this._baseURL),i=new Headers;i.append("Authorization",this.authorization),i.append("Content-Type","application/json");var n={method:"PATCH",headers:i,body:JSON.stringify(e)};const r=fetch(s,n).then((function(t){return __awaiter(this,void 0,void 0,(function*(){if(t.status<400){var e=yield t.json();return new OFSResponse(s,t.status,void 0,e)}return new OFSResponse(s,t.status,t.statusText,void 0)}))})).catch((t=>(console.log("error",t),new OFSResponse(s,-1))));return r}_put(t,e,s="application/json",i){var n=new URL(t,this._baseURL),r=new Headers;r.append("Authorization",this.authorization),r.append("Content-Type",s),"application/json"==s&&(e=JSON.stringify(e)),i&&r.append("Content-Disposition","attachment; filename="+i);return fetch(n,{method:"PUT",headers:r,body:e}).then((function(t){return __awaiter(this,void 0,void 0,(function*(){if(t.status<400){if(204==t.status)return new OFSResponse(n,t.status,void 0,void 0);var s=yield t.json();return new OFSResponse(n,t.status,void 0,s)}return new OFSResponse(n,t.status,t.statusText,e)}))})).catch((t=>(console.log("error",t),new OFSResponse(n,-1))))}_post(t,e){var s=new URL(t,this._baseURL),i=new Headers;i.append("Authorization",this.authorization),i.append("Content-Type","application/json");var n={method:"POST",headers:i,body:JSON.stringify(e)};const r=fetch(s,n).then((function(t){return __awaiter(this,void 0,void 0,(function*(){if(t.status<400){var e=yield t.json();return new OFSResponse(s,t.status,void 0,e)}return new OFSResponse(s,t.status,t.statusText,yield t.json())}))})).catch((t=>(console.log("error",t),new OFSResponse(s,-1))));return r}_postMultiPart(t,e){var s=new URL(t,this._baseURL),i=new Headers;i.append("Authorization",this.authorization);return fetch(s,{method:"POST",headers:i,body:e}).then((function(t){return __awaiter(this,void 0,void 0,(function*(){if(t.status<400){if(204==t.status)return new OFSResponse(s,t.status,void 0,void 0);var e=yield t.json();return new OFSResponse(s,t.status,void 0,e)}return new OFSResponse(s,t.status,t.statusText,void 0)}))})).catch((t=>(console.log("error",t),new OFSResponse(s,-1))))}_delete(t){var e=new URL(t,this._baseURL),s=new Headers;s.append("Authorization",this.authorization);return fetch(e,{method:"DELETE",headers:s}).then((function(t){return __awaiter(this,void 0,void 0,(function*(){return 204==t.status?new OFSResponse(e,t.status,void 0,void 0):new OFSResponse(e,t.status,t.statusText,yield t.json())}))})).catch((t=>(console.log("error",t),new OFSResponse(e,-1))))}getSubscriptions(){return __awaiter(this,void 0,void 0,(function*(){return this._get("/rest/ofscCore/v1/events/subscriptions")}))}createActivity(t){return __awaiter(this,void 0,void 0,(function*(){return this._post("/rest/ofscCore/v1/activities",t)}))}deleteActivity(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscCore/v1/activities/"+t;return this._delete(e)}))}getActivityDetails(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscCore/v1/activities/"+t;return this._get(e)}))}updateActivity(t,e){return __awaiter(this,void 0,void 0,(function*(){const s="/rest/ofscCore/v1/activities/"+t;return this._patch(s,e)}))}getActivityFilePropertyContent(t,e,s="*/*"){return __awaiter(this,void 0,void 0,(function*(){var i=new Headers;i.append("Accept",s);const n=`/rest/ofscCore/v1/activities/${t}/${e}`;return this._get(n,void 0,i)}))}getActivityFilePropertyMetadata(t,e){return __awaiter(this,void 0,void 0,(function*(){var s=new Headers;s.append("Accept","*/*");const i=`/rest/ofscCore/v1/activities/${t}/${e}`;return this._get(i,void 0,s)}))}getActivityFileProperty(t,e){return __awaiter(this,void 0,void 0,(function*(){var s=new Headers;const i=`/rest/ofscCore/v1/activities/${t}/${e}`;var n=yield this.getActivityFilePropertyMetadata(t,e);if(n.status<400){var r=n.contentType;r&&s.append("Accept",r);var o=this._get(i,void 0,s);return new OFSResponse(n.url,n.status,n.description,Object.assign(Object.assign({},n.data),{content:(yield o).data}),n.contentType)}return n}))}setActivityFileProperty(t,e,s,i,n="*/*"){return __awaiter(this,void 0,void 0,(function*(){const r=`/rest/ofscCore/v1/activities/${t}/${e}`;return this._put(r,s,n,i)}))}getUsers(t=0,e=100){return __awaiter(this,void 0,void 0,(function*(){return this._get("/rest/ofscCore/v1/users",{offset:t,limit:e})}))}getAllUsers(){return __awaiter(this,void 0,void 0,(function*(){var t=0,e=void 0,s={totalResults:0,items:[]};do{if(!((e=yield this._get("/rest/ofscCore/v1/users",{offset:t,limit:100})).status<400))return e;0==s.totalResults?s=e.data:s.items=s.items.concat(e.data.items),t+=100}while(100==e.data.items.length);return s}))}getUserDetails(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscCore/v1/users/"+t;return this._get(e)}))}importPlugins(e,s){return __awaiter(this,void 0,void 0,(function*(){var i=new FormData;if(e){var n=new Blob([t(e)],{type:"text/xml"});i.append("pluginFile",n,e.toString())}else{if(!s)throw"Must provide file or data";n=new Blob([s],{type:"text/xml"});i.append("pluginFile",n,"plugin.xml")}return this._postMultiPart("/rest/ofscMetadata/v1/plugins/custom-actions/import",i)}))}getProperties(t={offset:0,limit:100}){return __awaiter(this,void 0,void 0,(function*(){return this._get("/rest/ofscMetadata/v1/properties",t)}))}getPropertyDetails(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscMetadata/v1/properties/"+t;return this._get(e)}))}createReplaceProperty(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscMetadata/v1/properties/"+t.label;return this._put(e,t)}))}updateProperty(t){return __awaiter(this,void 0,void 0,(function*(){const e="/rest/ofscMetadata/v1/properties/"+t.label;return this._patch(e,t)}))}}OFS.DEFAULT_DOMAIN="fs.ocs.oraclecloud.com";export{OFS,OFSActivityResponse,OFSPropertyDetailsResponse,OFSPropertyListResponse,OFSResponse,OFSSubscriptionResponse};
